<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="description"
      content="Explore Nebraska's Tax Increment Financing (TIF) data with interactive visualizations and detailed reports on counties, cities, and projects by Code for Nebraska." />
    <meta name="keywords" content="Nebraska TIF, Tax Increment Financing, TIF data, Nebraska counties, open source, data visualization, Code for Nebraska" />
    <meta name="author" content="Code for Nebraska" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="[% title %] - Nebraska TIF Report" />
    <meta property="og:description" content="Discover Nebraska's Tax Increment Financing (TIF) data for [% title %] through interactive visualizations by Code for Nebraska." />
    <meta property="og:image" content="https://nebraska.tif.report/images/tif-report-og-image.jpg" />
    <meta property="og:url" content="[% url %]" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Nebraska TIF Report" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[% title %] - Nebraska TIF Report" />
    <meta name="twitter:description" content="Discover Nebraska's TIF data for [% title %] with interactive visualizations by Code for Nebraska." />
    <meta name="twitter:image" content="https://nebraska.tif.report/images/tif-report-og-image.jpg" />
    <meta name="twitter:site" content="@CodeForNebraska" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png" />

    <!-- Canonical URL -->
    <link rel="canonical" href="[% url %]" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Lunr.js CDN -->
    <script src="https://unpkg.com/lunr/lunr.js"></script>

    <title>[% title %] - Nebraska TIF Report</title>

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Nebraska TIF Report",
        "url": "[% url %]",
        "description": "Interactive Tax Increment Financing (TIF) data for Nebraskaâ€™s counties, cities, and projects.",
        "publisher": {
          "@type": "Organization",
          "name": "Code for Nebraska",
          "url": "https://github.com/codefornebraska"
        },
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://nebraska.tif.report/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    </script>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body class="antialiased bg-neutral-100">
    <!-- Navigation Bar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16 gap-8">
        <a href="/" class="text-2xl font-extrabold tracking-tight duration-300 flex items-center">Nebraska TIF Report</a>
        <!-- Search Bar -->
        <div class="relative w-full max-w-xs">
          <input
            type="text"
            id="search-input"
            placeholder="Search counties, cities, or projects..."
            class="w-full px-4 py-2 text-sm bg-black/10 border border-black/0 rounded-full focus:outline-none focus:bg-white focus:border-black/10"
            autocomplete="off" />
          <!-- Search Results -->
          <div
            id="search-results"
            class="absolute z-10 w-full mt-1 bg-white border border-black/10 rounded-2xl shadow-lg max-h-60 overflow-y-auto hidden p-2 flex flex-col gap-1"></div>
        </div>
      </div>
    </div>

    <!-- Hero Section -->
    <header class="py-10 sm:py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 gap-2 flex flex-col">
        <div class="flex items-start gap-4">
          [% IF url != 'http://nebraska.tif.report' %]
          <button
            onclick="window.history.back()"
            class="cursor-pointer bg-black/10 border border-black/10 items-center hover:text-black/50 p-2 rounded-full"
            aria-label="Go back to previous page">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                fill="currentColor"
                d="m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z" />
            </svg>
          </button>
          [% END %]
          <div class="flex flex-col gap-4">
            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-extrabold tracking-tight line-clamp-2">[% title %]</h1>
            [% IF children %]
            <span>[% children %]</span>
            [% END %]
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6 space-y-6">
      [% content %]
      <section class="bg-white rounded-4xl shadow-lg border border-black/10 p-6 sm:p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Comments</h2>
        <p class="text-base text-gray-600 mb-6">Share your thoughts or questions about this TIF data and engage with the community through the comments section below.</p>
        <div class="fb-comments" data-href="[% url %]" data-numposts="5" data-width="100%"></div>
      </section>
    </main>

    <!-- Footer Section -->
    <footer class="bg-white border-t border-gray-200 py-6">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-6">
          <!-- Logo/Brand -->
          <div class="flex items-center">
            <a href="/" class="text-lg font-bold text-gray-900 hover:text-blue-600 transition">Nebraska TIF Report</a>
          </div>

          <!-- Links -->
          <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-sm text-gray-600">
            <a href="/about.html" class="hover:text-blue-600 transition">About This Project</a>
            <a href="https://github.com/codefornebraska/tif" class="hover:text-blue-600 transition">GitHub Repository</a>
            <a href="mailto:contact@codefornebraska.org" class="hover:text-blue-600 transition">Contact Us</a>
            <a href="/privacy-policy.html" class="hover:text-blue-600 transition">Privacy Policy</a>
            <a href="/terms-of-use.html" class="hover:text-blue-600 transition">Terms of Use</a>
          </div>

          <!-- Social Media Icons -->
          <div class="flex items-center gap-3">
            <a href="https://twitter.com/CodeForNebraska" class="text-gray-600 hover:text-blue-600 transition" aria-label="Follow us on X">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
              </svg>
            </a>
          </div>
        </div>
        <!-- Copyright -->
        <div class="mt-4 text-center text-sm text-gray-500">&copy; 2025 Code for Nebraska. All rights reserved.</div>
        <span>Last updated on April 09, 2024</span>
      </div>
    </footer>

    <!-- Facebook Comments Script -->
    <script>
      (function (d, s, id) {
        var js,
          fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = '//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9&appId=260322844448067';
        fjs.parentNode.insertBefore(js, fjs);
      })(document, 'script', 'facebook-jssdk');
    </script>

    <!-- Search Functionality Script -->
    <script>
      const searchState = { index: null, docsMap: new Map() };
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');

      const loadSearchIndex = async () => {
        try {
          const response = await fetch('/search-index.json');
          const docs = await response.json();
          searchState.docsMap = new Map(docs.map(doc => [doc.id, doc]));
          searchState.index = lunr(function () {
            this.ref('id');
            this.field('name');
            this.field('type');
            docs.forEach(doc => this.add(doc));
          });
        } catch (error) {
          console.error('Search index loading failed:', error);
        }
      };

      const renderResults = results => {
        searchResults.innerHTML = '';
        results.forEach(result => {
          const doc = searchState.docsMap.get(result.ref);
          if (!doc) return;

          const link = document.createElement('a');
          link.href = doc.url || '#';
          link.className = 'inline-flex text-sm items-center px-3 py-1 bg-black/10 rounded-full border border-black/0 hover:bg-white hover:border-black/10';

          const nameSpan = document.createElement('span');
          nameSpan.textContent = doc.name || 'Unknown';

          const typeSpan = document.createElement('span');
          typeSpan.className = 'text-gray-500';
          typeSpan.textContent = doc.type || 'Unknown';

          link.append(nameSpan, document.createTextNode(' ('), typeSpan, document.createTextNode(')'));
          searchResults.appendChild(link);
        });
        searchResults.classList.toggle('hidden', !results.length);
      };

      const handleSearch = () => {
        const query = searchInput.value.trim();
        if (!query || !searchState.index || !searchState.docsMap.size) {
          searchResults.classList.add('hidden');
          return;
        }
        const results = searchState.index.search(query + '*');
        renderResults(results);
      };

      loadSearchIndex();

      searchInput.addEventListener('input', handleSearch);
      searchInput.addEventListener('focus', () => {
        if (searchResults.children.length) searchResults.classList.remove('hidden');
      });

      document.addEventListener('click', e => {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
    </script>
  </body>
</html>
